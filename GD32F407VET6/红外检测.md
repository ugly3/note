# 红外检测演示 — 项目说明

  

## 概述

- 本工程基于 GD32F4 系列 MCU（类似 STM32F4），功能为红外（人体/物体）检测并在 SSD1306 OLED 上显示，同时支持蜂鸣器、LED 与按键交互。

  

## 快速开始

- 使用 Keil MDK 打开工程文件：`Project/TEST.uvprojx`，选择目标板（GD32F407VET6），编译并下载至目标 MCU。

- 如果使用其他工具链，请确保链接器脚本、启动文件和系统时钟配置匹配目标芯片。

  

## 构建与运行要点

- 需在 Keil 中配置正确的设备型号并启用所需库（CMSIS / 标准外设库）。

- 注意 `printf` 在源码中被调用，若要在串口输出，请确保已实现 `fputc`/retarget 或串口重定向。

  

## 主要文件说明

- `User/main.c`：程序入口，依次初始化 SysTick、LED、按键、蜂鸣器、软件 I2C、OLED、红外传感，并在主循环中调用 `IR_Test()`。

- `User/systick.c`：SysTick 配置为 1kHz；实现 `delay_1ms()`, `delay_us()`；`delay_decrement()` 在中断中被调用来维护毫秒延时并触发蜂鸣器脉冲函数 `Beep_pulse()`。

- `User/gd32f4xx_it.c`：中断向量实现，`SysTick_Handler` 调用 `delay_decrement()`。

- `Hardware/led/`：LED 初始化（4 个 LED），在 `led.h` 中定义了对应引脚与时钟。

- `Hardware/button/`：按键 GPIO 初始化与 `Btn_Scan()` 去抖扫描函数，返回按键编号或 0。

- `Hardware/beep/`：蜂鸣器初始化与控制；`Beep_pulse()` 在 SysTick 周期翻转引脚以产生方波，`Beep_control()` 提供基于阻塞延时的脉冲控制。

- `Hardware/iic/`：软件 I2C（位操作）实现，提供 Start/Stop、读写字节、主机读写与内存写等高层 API。默认 `hiic1` 使用 PB10(SCL)/PB11(SDA)。

- `Hardware/OLED/`：基于软件 I2C 的 SSD1306 风格驱动，维护屏幕缓冲并提供绘图与文本函数（清屏/刷新/像素/字符串/图形）。

- `Hardware/ir/`：红外数字输入（PD3）初始化与简单测试 `IR_Test()`，在 OLED 上显示 "somebody" / "nobody" 并打印调试信息。

  

## 引脚分配（源码定义）

- LED1: PB2

- LED2: PE7

- LED3: PE8

- LED4: PE9

- 按键: PA0, PA1, PA4, PA5

- 蜂鸣器: PE11

- 软件 I2C: SCL = PB10, SDA = PB11

- OLED 复位: PE15

- 红外传感: PD3

  

## 重要实现细节与注意事项

- SysTick 配置为 1kHz，用于 `delay_1ms()` 及周期性任务（如 `Beep_pulse()`）。

- 软件 I2C 的时序依赖 `delay_us()`，因此在中断频繁或系统负载高时可能受影响；对时间敏感的 I2C 设备建议使用硬件 I2C 外设。

- `Beep_pulse()` 在 SysTick 中被调用，通过 `Beep_sw` 开关控制方波输出，适合低频提示音；若需稳定音频输出，请使用定时器 PWM。

- `IR_Test()` 直接在主循环中轮询红外引脚并更新 OLED，若需低功耗或更复杂事件处理，建议使用外部中断（EXTI）。

  

## 扩展建议

- 为 `printf` 添加串口重定向，方便调试输出。

- 将软件 I2C 替换为硬件 I2C（若 MCU 支持），提高稳定性。

- 使用外部中断处理红外与按键事件，减少主循环轮询并提高响应性。

  

---

文件路径：本 README 放置于工程目录下，便于阅读与发布。

  

